// Once the new learn_beta page is finished and out of beta, it will make sense
// to fold this file into base.less. However, to do so we have to tackle
// base_layout which is incompatible with the new learn page e.g. stuff
// on 'body', probably needs to gain a class

// 3rd party
@import "../bootstrap/lib/bootstrap.less";

// Common things
@import "icons.less";
@import "utils.less";
@import "themes.less";
@import "common.less";
@import "common_layout.less";
@import "sidepanel.less";


// learn page specific
body.learn-page {
    // Common styles to be merged eventually:
    // To be moved to common.less once this is fully merged.

    // Can also be simplified because there will be no specificity problems,
    // and other code can be deleted.
    a:focus, :focus, .fakefocus, .btn:focus input:focus textarea:focus, select:focus {
        outline: 3px solid #00ffff90;
        .box-shadow(none);
    }
    input:focus {
        // Needed for Chrome
        outline-offset: 0px;
    }
    // End common styles


    @topbarHeight: 36px;
    nav {
        // We need a fixed height, because this element has 'position: fixed'
        // and we need to allow for that in margins on top of remaining content.
        height: @topbarHeight;
        display: flex;
        flex-direction: row;
        justify-content: space-between;

        > div {
            height: @topbarHeight;
            line-height: @topbarHeight;
        }
        // Learn page dropdown, eventually everywhere:
        .nav-dropdown {
            position: relative; // establish container for .nav-dropdown

            .nav-dropdown-menu {
                display: none;
            }

            &.open .nav-dropdown-menu {
                display: block;
            }
        }

        .nav-dropdown-heading {
            height: @topbarHeight;
        }

        .nav-dropdown-menu {
            position: absolute;
            top: @topbarHeight;
            right: 0px;
        }
        .nav-dropdown-heading {
            padding-left: 5px;
            padding-right: 5px;
        }

        .spacer {
            flex-grow: 1;
        }

        .nav-caption {
            padding-left: 4px;
        }

        i.icon-fw + .nav-caption {
            padding-left: 0px;
        }

        .icon-fw::before {
            font-size: 120%;
            width: 1.5em;
        }
    }
    nav + div {
        margin-top: @topbarHeight;
    }

    // Specific nav drop downs

    // TODO - check/fix these colors to work with different themes.
    .ajax-retries .icon-fw,
    .ajax-retrying {
        color: yellow;
    }
    .ajax-failures .icon-fw,
    .ajax-failed {
        color: #ff2e2e;;
    }

    .ajax-info {
        .nav-dropdown-menu div {
            white-space: nowrap;
        }
        .nav-dropdown-heading.hidden a {
            cursor: default;
        }
    }

    #id-loading-full {
        color: #888;
        text-align: center;
        font-size: 48px;
        vertical-align: middle;
        line-height: calc(~"100vh - 2 * " @topbarHeight);
        animation: fadeIn 1s infinite alternate;
    }

    #id-content-wrapper {
        padding-left: 0.5em;
        padding-right: 0.5em;
        margin-left: auto;
        margin-right: auto;
        max-width: 860px;
    }

    // Title

    .blurry {
        color: transparent;
        text-shadow: 0 0 15px rgba(0,0,0,0.6);
    }

    // Words
    #id-verse-wrapper {
        border-radius: 5px;
        padding: 10px;
        background-color: #f0f0f0;
    }

    #id-copyright-notice {
        font-size: 0.9em;
        text-align: right;
        border-top: 1px solid #ccc;
        padding-top: .2em;
        margin-top: .2em;
    }

    @currentVerseFontSize: 20px;
    .current-verse, #id-typing, #id-onscreen-test-options {
        font-size: @currentVerseFontSize;
        line-height: 1; // The paddings on word buttons are enough, extra not needed
    }

    .previous-verse {
        font-size: @currentVerseFontSize;
        line-height: @readingLineHeight;
    }

    @readingLineHeight: 1.5;
    .read-for-context {
        line-height: @readingLineHeight;
    }

    #id-onscreen-not-available {
        font-size: 20px;
    }

    .previous-verse-wrapper {
        border-bottom: 1px solid #c0c0c0;
        margin-bottom: 0.5em;
        position: relative; // establish containing box.
        height: @currentVerseFontSize * @readingLineHeight; // Constrain to showing one line only
        overflow: hidden;
    }
    .previous-verse {
        color: #909090;
        position: absolute;
        bottom: 0px;
    }

    .normalWordBorderColors() {
        border-color: #C0C0C0;
        border-top-color: #D8D8D8;
        border-bottom-color: #9A9A9A;
    }

    @word-margin-top: 3px;
    @word-margin-left: 1px;
    @word-padding-horizontal: 4px;

    .word-button {
        border: 2px solid;
        border-radius: 3px;
        padding: 4px @word-padding-horizontal;
        margin: @word-margin-top @word-margin-left;
        .gradientBar(#e8e8e8, #C0C0C0);
        .normalWordBorderColors();
        &.clickable {
            cursor: pointer;
        }

        &.correct {
            border-color: #00D000;
        }

        &.incorrect {
            border-color: red;
        }

        &.partially-correct {
            border-color: #D0B800;
        }

        &.current {
            border-color: black;
        }

    }
    #id-typing {
        color: black;
        // These values are important for matching size of .word-button.
        // Left padding matches to get the word to line up,
        // the others don't to give more room for typing.
        // See also setup_learn.js
        padding: 0 0 0 @word-padding-horizontal;
        margin: 0;
        border: 2px solid; // same as .word-button.
        position: absolute;
        display: none; // initially hide
        z-index: 100;
        &.incorrect {
            border-color: red;
        }
    }

    .hidden {
        opacity: 0;
    }
    .colon {
        margin-left: 3px;
    }
    .wordend, .wordstart, .word-button, .reading-word {
        display: inline-block;
    }

    // hide the clues that show word size
    .hide-word-boundaries .word-button {
        border-left: 0px;
        border-right: 0px;
        padding-left: 8px;
        padding-right: 8px;
        margin-left: -5px;
        margin-right: -5px;
        border-radius: 0px;
        cursor: default;

        &.current {
            .normalWordBorderColors();
            border-left: 2px solid blue;
        }
    }

    #id-hint-btn, #id-help-btn, #id-more-practice-btn, .word-button.clickable {
        // For Internet Explorer, remove 300ms delays on "click" event when touch
        // actions are used.
        touch-action: none;
    }

    h1, h2, h3 {
        line-height: 1.4;
        padding-top: 5px;
    }

    #id-onscreen-test-container {
        border-width: 2px;
        border-style: solid;
        border-radius: 5px;
        margin-bottom: 10px;
        padding: 6px;
        text-align: center;
        .word-button {
            margin: 8px;
        }
    }

    .fixed-bottom() {
        position: fixed;
        z-index: 20;
        bottom: 0;
        left: 0;
        width: 100%;
        border-bottom-width: 0px;
        border-left-width: 0px;
        border-right-width: 0px;
        height: auto;
        border-radius: 0px;
        margin: 0px;
    }

    #id-action-btns {
        box-sizing: border-box;
        background-color: white;
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: flex-end;
        margin-top: 0.2em;
        > * {
            margin-left: 5px;
        }
    }

    #id-hint-btn-container .btn {
        float: right;
        margin-top: 4px;
        margin-left: 4px;
    }

    #id-instructions {
        margin-top: 0.2em;
    }

    #id-help {
        margin-top: 0.5em;
        color: #606060;
        h1, h2, h3, h4 {
            color: #606060;
        }
    }

    // We may have a fixed bottom bar, but want to ensure this doesn't cover up
    // the help (and anything else) on the paage. Sometimes the bar can cover
    // half the screen, so allow room for it.
    #elm-main {
        margin-bottom: 50vh;
    }

    @media screen and (max-width: @narrowWidthBreak2) {
        .nav-caption {
            display: none;
        }

        nav {
            .nav-dropdown {
                // Do NOT establish container for .nav-dropdown,
                // because dropdown is now filliing whole width
                position: static;
            }
            .nav-dropdown-menu {
                top: @topbarHeight;
                left: 0px;
                width: 100%;
            }
        }
    }

    @word-margin-top-small: 3px;
    @word-margin-left-small: 1px;
    @word-padding-horizontal-small: 2px;

    @media screen and (max-width: @narrowWidthBreak2), screen and (max-height: @shortHeightBreak2) {

        // If not much room in either direction, shrink the fonts of the verse
        // words to make more room
        @currentVerseSmallerFontSize: 18px;
        .current-verse, .previous-verse, #id-typing, #id-onscreen-test-options, #id-onscreen-not-available, #id-typing {
            font-size: @currentVerseSmallerFontSize;
        }
        .previous-verse-wrapper {
            height: @currentVerseSmallerFontSize * @readingLineHeight;
        }

        .word-button {
            padding: 2px @word-padding-horizontal-small;
        }
        #id-typing {
            padding-left: @word-padding-horizontal-small;
        }
        .word-button {
            margin: @word-margin-top-small @word-margin-left-small;
        }

        #id-verse-wrapper {
            border-radius: 3px;
            padding: 5px;
        }

        #id-onscreen-test-container {
            .fixed-bottom();
            .word-button {
                // Easier to press:
                padding: 3px 5px;
                min-width: 25px;
            }
        }

        #id-action-btns {
            padding: 8px;
            border-top-style: solid;
            border-top-width: 2px;
            .fixed-bottom();
            justify-content: space-between;
            > * {
                margin-left: 0;
                // Make buttons easier to press on mobile
                flex-grow: 0.3;
            }
        }
    }
}

@keyframes fadeIn {
    from { opacity: 0.25; }
}

{% extends "base.html" %}

{% load url from future %}
{% load pagination_tags %}
{% load bootstrap %}
{% load spurl %}
{% load markup %}

{% block content %}

<p>Choose a pre-made set of verses to start learning, or choose some individual
 verses.

<p>(You can also <a href="{% url 'create_set_menu' %}">create your own verse sets</a>)</p>

<ul class="tabs" data-tabs="tabs">
  <li {% if active_tab == 'verseset' %}class="active"{% endif %}><a href="#id-tab-verseset">Verse sets</a></li>
  <li {% if active_tab == 'individual' %}class="active"{% endif %}><a href="#id-tab-individual">Individual verses</a></li>
</ul>

<div class="pill-content">
  <div {% if active_tab == 'verseset' %}class="active"{% endif %} id="id-tab-verseset">

    <table>
      <tr>
        <th>Order:</th>
        <td>
          <ul class="pills">
            {% if 'new' not in request.GET %}
            <li class="active"><a href="">Most popular first</a></li>
            {% else %}
            <li><a href="{% spurl base=request.get_full_path add_query='popular' remove_query_param='new' %}">Most popular first</a></li>
            {% endif %}
            {% if 'new' in request.GET %}
            <li class="active"><a href="">Newest first</a></li>
            {% else %}
            <li><a href="{% spurl base=request.get_full_path add_query='new' remove_query_param='popular' %}">Newest first</a></li>
            {% endif %}
          </ul>
        </td>
      </tr>
      <tr>
        <th>Type:</th>
        <td>
          <ul class="pills">
            {% if 'selections' not in request.GET and 'passages' not in request.GET %}
            <li class="active"><a href="">All</a></li>
            {% else %}
            <li><a href="{% spurl base=request.get_full_path remove_query_param='selections' remove_query_param='passages' remove_query_param='page' %}">All</a></li>
            {% endif %}
            {% if 'selections' in request.GET %}
            <li class="active"><a href="">Selections</a></li>
            {% else %}
            <li><a href="{% spurl base=request.get_full_path add_query='selections' remove_query_param='passages'  remove_query_param='page' %}">Selections</a></li>
            {% endif %}
            {% if 'passages' in request.GET %}
            <li class="active"><a href="">Passages</a></li>
            {% else %}
            <li><a href="{% spurl base=request.get_full_path add_query='passages' remove_query_param='selections'  remove_query_param='page' %}">Passages</a></li>
            {% endif %}
          </ul>
        </td>
      </tr>
      <tr>
        <th>Search:</th>
        <td>
          <form action="" method="GET">
            <input type="text" name="q"  id="id-search-input" value="{{ request.GET.q }}"/>
            <input type="submit" class="btn primary" value="Search" id="id-search-btn" />
          </form>
        </td>
    </table>
    {% autopaginate verse_sets 10 %}

    {% if request.GET.q %}
    <h2>Search results:</h2>
    {% endif %}

    {% if not verse_sets %}
    <p>No verse sets found that match your query.</p>
    {% endif %}

    {% for vs in verse_sets %}
    <div class="verseset">
      <form action="" method="POST">
        {% csrf_token %}
        <input type="hidden" name="verseset_id" value="{{ vs.id }}">
        <input type="submit" class="btn primary needs-preferences" value="Learn" id="id-learn-verseset-btn-{{ vs.id }}">
      </form>
      <h3>{{ vs.name }}</h3>
      {% if vs.description %}
      <p>{{ vs.description|restructuredtext }}</p>
      {% endif %}
      {% if not vs.is_passage and vs.verse_choices.all %}
      <p>Includes the following verses, {{ vs.verse_choices.all|length }} in total:<br/>
        {% for v in vs.verse_choices.all|slice:"0:10" %}
        {{ v.reference }}{% if not forloop.last %}, {% endif %}
        {% endfor %}
        {% if vs.verse_choices.all|length > 10 %}â€¦and more.{% endif %}
      </p>
      {% endif %}
      {% if vs.is_passage and vs.breaks %}
      <p>Section breaks at: {{ vs.breaks_formatted }}</p>
      {% endif %}
      <div><a href="{{ vs.get_absolute_url }}">See more</a></div>
    </div>
    {% endfor %}

    {% paginate %}

  </div>

  <div {% if active_tab == 'individual' %}class="active"{% endif %} id="id-tab-individual">
    <p>Choose a verse (or a few verses). For long passages, you should
      <a href="{% url 'create_passage_set' %}">create a 'passage' verse set</a>.
    </p>

    {% include "learnscripture/quick_find_controls.html" %}

    <script id="id_individual_choose_result_template" type="text/x-jsrender">
      {# template for .quickfind_search_results #}
      <div class="actionset">
        <form action="" method="POST">
          {% csrf_token %}
          <input type="hidden" name="reference" value="[[>reference]]">
          <input type="hidden" name="version_slug" value="[[>version_slug]]">
          <input type="submit" class="btn primary needs-preferences" value="Learn">
        </form>
        <h3>[[>book_name]]</h3>
        <div class="verselist">
          [[for verses]]
          <div class="verse">
            <span class="versenumber">[[>chapter_number]]:[[>verse_number]]</span> [[:html_text]]
          </div>
          [[/for]]
        </div>
      </div>
    </script>

  </div>

</div>
{% endblock %}

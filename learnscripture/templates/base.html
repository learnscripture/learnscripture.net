{% load url from future %}
{% load compress %}
{% load bootstrap %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>{% block title %}{% if title %}{{ title }} - {% endif %}LearnScripture.net{% endblock %}</title>
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0" />

    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->


    {% if request.identity.interface_theme == 'bubblegum' or request.identity.interface_theme == 'bubblegum2' %}
    <link href='http://fonts.googleapis.com/css?family=Short+Stack' rel='stylesheet' type='text/css' />
    {% endif %}
    {% if request.identity.interface_theme == 'space' %}
    <link href='http://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet' type='text/css'>
    {% endif %}
    <link rel="apple-touch-icon" href="{{ STATIC_URL }}img/touch-icon.png" />

    {% compress css %}
    <link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}css/heydings.css" charset="utf-8" />
    <link type="text/less" rel="stylesheet" href="{{ STATIC_URL }}css/learnscripture.less" charset="utf-8" />

    {% endcompress %}

  </head>

  <body class="{% if request.identity %}{{ request.identity.interface_theme }}{% else %}calm{% endif %}">

    <div class="topbar">
      <div class="fill">
        <div class="container">
          <div class="topbarinner">
          <a class="brand" href="/">Learn Scripture</a>
          <ul class="nav primary-nav">
            {% for m in menuitems %}
            <li {% if m.active %}class="active"{% endif %}><a href="{{ m.path }}">{{ m.caption }}</a></li>
            {% endfor %}
          </ul>
          <div class="nav secondary-nav">
            <ul>
              <li class="dropdown" data-dropdown="dropdown">
                <a href="#" id="id-session-menu" class="dropdown-toggle holds-username">{% if request.identity.account %}{{ request.identity.account.username }}{% else %}Guest{% endif %}</a>
                <ul class="dropdown-menu">
                  {% if not request.identity.account %}
                  <li><a href="#" class="icon-login login-link">Sign in</a></li>
                  <li><a href="#" class="icon-account signup-link">Create account</a></li>
                  {% endif %}
                  <li><a class="icon-preferences preferences-link" href="{% url 'preferences' %}?next={{ request.path_info }}">Preferences</a></li>
                  {% if request.identity.account %}
                  <li><a class="icon-account" href="{% url 'account_details' %}">Account details</i></a></li>
                  <li><a class="icon-progress" href="{% url 'user_verses' %}">Verses</a>
                  <li><a class="icon-stats" href="{% url 'user_stats' request.identity.account.username %}">Stats</a></li>
                  <li><a href="#" class="icon-logout logout-link">Log out</a></li>
                  {% endif %}
                </ul>
              </li>
            </ul>
          </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="maincontent">
        <div class="page-header">
          <div id="id-ajax-errors"></div>
          <h1>{% block page_title %}{{ title }}{% endblock %}</h1>
        </div>

        {% block messages %}
        {% if notices %}
        <div class="message-container">
        {% for notice in notices %}
          <div class="notice">
            <a class="close" title="Clear this message" href="#" data-notice-id="{{ notice.id }}">Ã—</a>
            {{ notice.message_html|safe }}
          </div>
        {% endfor %}
        </div>
        {% endif %}

        {% if messages %}
        <div class="message-container">
          <ul class="messagelist">
            {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
        {% endblock %}

        {% block content %}
        {% endblock %}

      </div>

      {% block referral_links %}
      {% if request.identity.account and include_referral_links %}
      <div class="footer clearfix">
        <div class="referral-link"><a href="{{ referral_link }}">referral link</a> | <a href="/referral-program/">What's this?</a></div>
        <div class="fb-like" data-send="true" data-layout="button_count" data-show-faces="true" data-action="recommend"></div>
        <div><a href="https://twitter.com/share?url={{ referral_link|urlencode }}&text=" class="twitter-share-button" data-lang="en">Tweet</a>
        </div>
      </div>
      {% endif %}
      {% endblock %}
      <footer>
        <p><a href="/help/">Help</a> |
          <a href="/about/">About</a> |
          <a href="/terms-of-service/">Terms of service</a> |
          <a href="/contact/">Contact us</a></p>
        <p>&copy; LearnScripture.net 2012</p>
      </footer>

    </div> <!-- /container -->


<!-- popup forms -->
{% if not request.identity.account %}

<div id="id-signup-form" class="modal hide">
  <div class="modal-header">
    <a href="#" class="close">&times;</a>
    <h3>Create account</h3>
  </div>

  <div class="modal-body">
    <form action="" method="POST">
      {% csrf_token %}
      {{ signup_form|bootstrap }}
    </form>
    <p>By creating an account, you are agreeing to our
      <a href="/terms-of-service/" target="_blank">terms of service</a> and
      <a href="/privacy-policy/" target="_blank">privacy policy</a>.
      Please note that children under the age of 13 may not create
      an account.
    </p>
  </div>
  <div class="modal-footer">
    <a href="#" id="id-create-account-btn" class="btn primary default">Create account</a>
    <a href="#" id="id-create-account-cancel-btn" class="btn secondary">Cancel</a>
  </div>
</div>



<div id="id-login-form" class="modal hide">
  <div class="modal-header">
    <a href="#" class="close">&times;</a>
    <h3>Sign in</h3>
  </div>

  <form action="{% url 'login' %}" method="POST">
    {% csrf_token %}

  <div class="modal-body">
      {{ login_form|bootstrap }}
  </div>
  <div class="modal-footer">
    <input type="submit" id="id-sign-in-btn" class="btn primary default" value="Sign in" />
    <a href="#" id="id-sign-in-cancel-btn" class="btn secondary">Cancel</a>
    <input type="submit" id="id-forgot-password-btn" class="btn" value="I forgot my password" />
  </div>
  </form>
</div>

{% endif %}

{% if request.identity.account %}

<div id="id-logout-form" class="modal hide">
  <div class="modal-header">
    <a href="#" class="close">&times;</a>
    <h3>Logout</h3>
  </div>

  <div class="modal-body">
    <form action="" method="POST">
      {% csrf_token %}
      <p>Are you sure you want to log out?</p>
    </form>
  </div>
  <div class="modal-footer">
    <a href="#" id="id-logout-btn" class="btn primary default">Logout</a>
    <a href="#" id="id-logout-cancel-btn" class="btn secondary">Cancel</a>
  </div>
</div>

{% endif %}

{% if not hide_preferences_popup %}

<div id="id-preferences-form" class="modal hide">
  <div class="modal-header">
    <a href="#" class="close">&times;</a>
    <h3>Preferences</h3>
  </div>

  <div class="modal-body">
    <form action="" method="POST">
      {% csrf_token %}

      {{ preferences_form|bootstrap }}

    </form>
  </div>
  <div class="modal-footer">
    <a href="#" id="id-preferences-save-btn" class="btn primary default">Save</a>
    <a href="#" id="id-preferences-cancel-btn" class="btn secondary">Cancel</a>
  </div>
</div>

{% endif %}

<div id="id-preferences-data"
     {# NB these names are translated to preferencesSetup, enableAnimations, interfaceTheme, testingMethod #}
     data-preferences-setup="{{ request.identity.preferences_setup|yesno:"true,false,false" }}"
     data-enable-animations="{{ request.identity.enable_animations|yesno:"true,false,false" }}"
     data-interface-theme="{{ request.identity.interface_theme }}"
     data-testing-method="{{ request.identity.testing_method }}">
</div>


    {% comment %}
    We put javascript for *all* pages in the base template, with maximum expiry
    set up. This results in a bigger initial hit, but much better performace
    after that since the client only needs to ask for one js file (due to
    compressor) and never needs to request any js again

    We also put them at the bottom for speed.
    {% endcomment %}

    {% compress js %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/lib/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/lib/json2.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/lib/jquery-ui-1.8.17.custom.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/lib/jsrender.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/lib/jquery.ajaxretry.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}bootstrap/js/bootstrap-dropdown.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}bootstrap/js/bootstrap-modal.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}bootstrap/js/bootstrap-tabs.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}bootstrap/js/bootstrap-buttons.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}bootstrap/js/bootstrap-twipsy.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}bootstrap/js/bootstrap-popover.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/common.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/notices.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/bible_book_info.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/quickfind.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/learn.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/accounts.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/choose.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/create.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/preferences.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/viewset.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/modals.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/dashboard.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/subscribe.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/versepopup.js"></script>
    {% endcompress %}

    {% if request.identity.account and include_referral_links %}
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    {% endif %}

    {% block extrajs %}
    {% endblock %}

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29644888-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>
